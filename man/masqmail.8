.TH masqmail 8 2010-07-23 masqmail-0.3.0 "Maintenance Commands"

.SH NAME
masqmail \- An offline Mail Transfer Agent

.SH SYNOPSIS
\fB/usr/sbin/masqmail \fR[\fB\-C \fIfile\fR] [\fB\-odq\fR] [\fB\-bd\fR] [\fB\-q\fIinterval\fR]

\fB/usr/sbin/masqmail \fR[\fB\-odq\fR] [\fB\-bs\fR]

\fB/usr/sbin/masqmail \fR[\fB\-bp\fR]

\fB/usr/sbin/masqmail \fR[\fB\-q\fR]

\fB/usr/sbin/masqmail \fR[\fB\-qo \fR[\fIname\fR]]

\fB/usr/sbin/masqmail \fR[\fB\-t\fR] [\fB\-oi\fR] [\fB\-f \fIaddress\fR] [\fB\-\-\fR] \fIaddress...

\fB/usr/sbin/mailq\fR


.SH DESCRIPTION

Masqmail is a mail server designed for hosts that do not have a permanent internet connection
e.g. a home network or a single host at home.
It has special support for connections to different ISPs.
It replaces sendmail or other MTAs such as qmail or exim.


.SH OPERATION MODES

Masqmail operates in one of several exclusive modes.

The daemon mode has two flavors that may be,
and usually are, combined:
.TP
.B \-bd
listen daemon; listens for incoming SMTP connections.
.TP
.B \-q\fRINTERVAL
queue daemon; processes the queue in a regular interval.

.P
The queue processing mode has two flavors that may be combined:
.TP
.BR \-q
(without argument)
do a single queue run.
.TP
.B \-qo
do a single queue run and deliver only using a specific online route.

.P
The other modes are simple ones:
.TP
.B \-bi
a no-op for masqmail, just exit.
.TP
.B \-bm
accept messages on stdin. (The default)
.TP
.B \-bp
print the contents of the queue.
.TP
.B \-bs
accept messages by speaking SMTP on stdin.
.TP
.B \-bV
print version information.
.TP
.B \-Mrm
remove messages from the queue.
.P
Some of the modes are also available by calling masqmail
under a special name.

When no mode had been specified by either one of the above command line
options or by calling masqmail under a special name,
then the default mode \fB\-bm\fR
(i.e. accept messages on stdin) is entered.
However, if neither address arguments are specified nor
\fB\-t\fR is given, then no recipients are available and thus mail can not
be sent, hence something more useful is done: \fB\-bV\fP is assumed.


.SH OPTIONS

Since masqmail is intended to replace sendmail,
it uses the same command line options,
but not all are implemented.
The \fB\-qo\fP option is additional, and unique to masqmail.

.TP
\fB\-\-\fR

Not a `real' option, it means that all following arguments are to be understood
as arguments and not as options even if they begin with a leading dash `\-'.
Mutt is known to call sendmail with this option.

.TP
\fB\-bd\fR

Run as daemon, accepting connections,
usually on port 25 if not configured differently.
This is usually used in the startup script at system boot and together with
the \fB\-q\fR option (see below).

.TP
\fB\-bi\fR

Old sendmail rebuilds its alias database when invoked with this option.
Masqmail reads directly from the file given with `alias_file' in the config file.
Hence masqmail simply exits in this mode.

.TP
.B \-bm

Accept a text message on stdin.
This is the default mode of operation.
One will hardly use this switch as it is the default.

.TP
\fB\-bp\fR

Show the messages in the queue.
Same as calling masqmail as `mailq'.

.TP
\fB\-bs\fR

Accept SMTP commands from stdin.
Some mailers (e.g. pine) use this option as an interface.
It can also be used to call masqmail from inetd.

.TP
\fB\-bV \fR

Show version information, then exit.

.TP
\fB\-B \fIarg\fR

\fIarg\fR is usually 8BITMIME.
Some mailers use this to indicate that the message contains characters > 127.
Masqmail is 8-bit clean and ignores this, so you do not have to recompile elm,
which is very painful ;-).
Note though that this violates some conventions:
masqmail does not convert 8 bit messages to any MIME format if it encounters
a mail server which does not advertise its 8BITMIME capability,
masqmail does not advertise this itself.
This is the same practice as that of exim (but different to sendmail).

.TP
\fB\-C \fIfilename\fR

Use another configuration than \fI/etc/masqmail/masqmail.conf\fR.
Useful for debugging purposes.
If not invoked by a privileged user, masqmail will drop all privileges.

.TP
\fB\-d \fInumber\fR

Set the debug level.
This takes precedence before the value of `debug_level' in the configuration file.
Read the warning in the description of the latter.
Only root may set the debug level.

.TP
\fB\-f [\fIaddress\fB]\fR

Set the return path address to \fIaddress\fR.
Only root, the user mail and anyone in group mail is allowed to do that.

.TP
\fB\-F [\fIstring\fB]\fR

Set the full sender name (in the From: header) to \fIstring\fR.

.TP
\fB\-i\fR

Same as \fB\-oi\fR, see below.
Kept for compatibility.

.TP
\fB\-Mrm \fImsgid...\fR

``Queue manipulation mode''

Remove given messages from the queue.
Privileged users may remove any message, other users only their own.
The message identifiers are listed in the output of
\fImasqmail \-bp\fP (aka. \fImailq\fR).

.TP
\fB\-m\fR

``Me too''
This switch is ignored as,
masqmail never excludes the sender from any alias expansions.

\fB\-m\fP is an ancient alias for \fB\-om\fP.
Kept for compatibility.

.TP
\fB\-odb\fR

``Deliver in Background''
Masqmail always does this.
Hence masqmail ignores this switch.

.TP
\fB\-odq\fR

``Do Queueing''
Do not attempt to deliver immediately.
Any messages will be queued until the next queue running process picks them
up and delivers them.
You get the same effect by setting the do_queue option in
/etc/masqmail/masqmail.conf.

.TP
\fB\-oi\fR

A dot as a single character in a line does not terminate the message.

The same as \fB\-i\fP.

.TP
\fB\-oXXX\fR

Any other switch starting with `\-o' is ignored.
This especially affects \-om, \-oem, \-oee.

.TP
\fB\-q [\fIinterval\fB]\fR

Without argument:
Do a single queue run, i.e. try to deliver all messages in the queue.
Masqmail sends to addresses on the local host, on the local net,
and if it detects an online connection, to remote ones too.
That means, that masqmail sends any queued mail it can.
.B \-q
includes
.B \-qo
(without argument).

With an argument:
Start as a daemon and do a queue run automatically once in the specified
time interval.
This is usually used together with \fB\-bd\fR (see above).

An argument may be a time interval i.e. a numerical value followed by one
of the letters s,m,h,d,w which are interpreted as
seconds, minutes, hours, days or weeks respectively.
Example: \fB\-q30m\fR.

Running masqmail from inetd and starting single queue runs from cron
mimics the same effect as starting masqmail with something like
\fB\-bd \-q30m\fR.

.TP
\fB\-qo [\fIname\fB]\fR

Online queue runs.

Without a connection name:
Determine the online status with the configured method
(see \fBonline_detect\fR in \fBmasqmail.conf(5)\fR)
and, if a connection is available, send remote mail over it.

With a connection name:
Send remote mail over the specified connection,
no online detection is made.

The specified route configuration is read and queued mail to remote
recipients will be sent.
The \fIname\fR is defined in the configuration (see \fBonline_routes.\fIname\fR).

Use this option in your script which starts as soon as a link to the internet
has been set up (usually ip-up).

.TP
\fB\-t\fR

Read recipients from mail headers and add them to the ones specified on the
command line.
(Only To:, Cc:, and Bcc: headers are regarded.)

.B WARNING: The behavior changed with version 0.3.1!

In earlier versions command line argument addresses were ``substracted''
from header addresses.

The old behavior was similar to exim's and smail's
(which are anchesters of masqmail).
The new behavior is similar to the one of current postfix versions,
which add the arguments to the set of header recipients.
(Earlier postfix failed in case of address arguments with \-t.)
Sendmail seems to behave differently, depending on the version.
See exim(8) for further information.

For masqmail the most simple approach had been taken.

As the behavior of \-t together with command line address arguments
differs among MTAs, one better not steps into this corner case.

.TP
\fB\-v\fR

``Verbose''
Log also to stdout.
Currently, some log messages are marked as `write to stdout' and additionally,
all messages with priority `LOG_ALERT' and `LOG_WARNING' will be written to stdout
if this option is given. It is disabled in daemon mode.


.SH ENVIRONMENT FOR PIPES AND MDAS

For security reasons, before any pipe command from an alias expansion or an mda is called,
the environment variables will be completely discarded and newly set up. These are:

SENDER, RETURN_PATH \(en the return path.

SENDER_DOMAIN \(en the domain part of the return path.

SENDER_LOCAL \(en the local part of the return path.

RECEIVED_HOST \(en the host the message was received from (unless local).

LOCAL_PART, USER, LOGNAME \(en the local part of the (original) recipient.

MESSAGE_ID \(en the unique message id.
This is not necessarily identical with the Message ID as given in the Message ID: header.

QUALIFY_DOMAIN \(en the domain which will be appended to unqualified addresses.


.SH FILES

\fI/etc/masqmail/masqmail.conf\fR is the main configuration for masqmail.
Depending on the settings in this file, you will also have other configuration
files in \fI/etc/masqmail/\fR.

\fI/var/spool/masqmail/\fR is the spool directory where masqmail stores
its spooled messages.

\fI/var/spool/mail/\fR is the directory where locally delivered mail will be put,
if not configured differently in \fImasqmail.conf\fR.

\fI/var/log/masqmail/\fR is the directory where masqmail stores its log mesages.
This can also be somewhere else if configured differently by your sysadmin or the package mantainer.


.SH CONFORMING TO

RFC 821, 822, 1869, 1870, 2197, 2554 (SMTP)

RFC 1321 (MD5)

RFC 2195 (CRAM-MD5)


.SH AUTHOR

Masqmail was written by Oliver Kurth.
It is now maintained by Markus Schnalke <meillo@marmaro.de>.

You will find the newest version of masqmail at \fBhttp://marmaro.de/prog/masqmail/\fR.
There is also a mailing list, you will find information about it at masqmail's main site.


.SH BUGS

Please report them to the mailing list.


.SH SEE ALSO

\fBmasqmail.conf(5)\fR, \fBmasqmail.route(5)\fR, \fBmasqmail.aliases(5)\fR
